VM CREATION
Invoke-WebRequest -UseBasicParsing -Uri https://raw.githubusercontent.com/microsoft/WSLab/master/Tools/Convert-WindowsImage.ps1 -OutFile .\Convert-WindowsImage.ps1
import-module .\convert-windowsimage.ps1
Convert-WindowsImage -SourcePath "d:\sources\install.wim" -VHDFormat "VHDX" -Edition "Windows Server 2019 Standard" -SizeBytes 50GB -DiskLayout "UEFI" -VHDPath ".\WSCore2019.vhdx"


HyperV VM Exploration:
HW Additions:
Get-command Add-VM*

Boot Order / UEFI Gen2 VM:
(Get-VMFirmware -VMName YOURVMNAME).BootOrder

$hd = Get-VMHardDiskDrive -VMName *2016*
Set-VMFirmware -VMName YOURVMNAME -FirstBootDevice $hd -WhatIf
	
Security settings
Display Secure Boot settings:
Get-VMFirmware -VMName lab6_ws2016_01 | Format-List sec*

Example to enable Secure Boot:
Set-VMFirmware -VMName lab6_ws2016_01 -EnableSecureBoot On  

Example to enable vTPM[*]:
Get-VMSecurity -VMName lab6_ws2016_01 

Enable-VMTPM -VMName lab6_ws2016_01 

[*] enabling vTPM might need add protector if you use PowerShell as in following example
$guardian = Get-HgsGuardian | Select-Object -first 1
if($guardian -eq $null) {
  $guardian = New-HgsGuardian -Name MyGuardian -GenerateCertificates
}
$keyprotector = New-HgsKeyProtector -Owner $guardian -AllowUntrustedRoot
Set-VMKeyProtector -VMName <yourVMName> -KeyProtector $keyprotector.RawData
Memory settings


Memory settings:
Virtual Machine has Network Virtualization Extensions exposed (Nested Virtualization is on), therefore Dynamic Memory settings are not effective on VMs, where Hyper-V is enabled.
PowerShell examples:
Example to display all memory parameters:
Get-VMMemory -VMName lab6_ws2016_01 | fl *

To modify startup memory you can use following command:
Set-VMMemory -VMName lab6_ws2016_01 -StartupBytes 2GB 

Processor settings:
Navigate to Processor and review the settings.
Notice also Compatibility settings and NUMA node settings.
PowerShell examples:
To view processor settings, you can use following command:
Get-VMProcessor -VMName lab6_ws2016_01 | fl *

For example to set nested virtualization, you can use following command:
Set-VMProcessor -VMName lab6_ws2016_01 -ExposeVirtualizationExtensions $true 

-------------------------------------------------------------------------------



